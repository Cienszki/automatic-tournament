"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8187],{19050:(e,a,t)=>{t.d(a,{Jt:()=>g,l:()=>_});var r=t(55835),o=t(56104),i=t(35317);async function s(e){let a=(0,i.H9)(o.db,"processedGames",e);await (0,i.BN)(a,{processedAt:new Date().toISOString()})}var n=t(9086),c=t(34477);let l=(0,c.createServerReference)("405b5fd1cd0c51bbaa7bc754ce0ef3219e52fd1063",c.callServer,void 0,c.findSourceMapURL,"getSteam64IdFromUrl"),m=(0,c.createServerReference)("404be2fa31196650e72a66294175e5dcead20e0c1c",c.callServer,void 0,c.findSourceMapURL,"getOpenDotaAccountIdFromUrl"),d=(0,c.createServerReference)("401becb040a1cf67b45b073da9720d005af0305e24",c.callServer,void 0,c.findSourceMapURL,"getSteamPlayerSummary");var u=t(68663);let p=u.Ik({name:u.Yj().min(3),tag:u.Yj().min(2).max(4),discordUsername:u.Yj().min(2),motto:u.Yj().min(5),logoUrl:u.Yj().url().optional(),captainId:u.Yj(),players:u.YO(u.Ik({nickname:u.Yj().min(2),role:u.Yj(),mmr:u.ai().min(1e3).max(12e3),steamProfileUrl:u.Yj().url(),profileScreenshotUrl:u.Yj().url()})).min(5).max(5)});var f=t(4028),h=t(49509);async function g(e,a){try{console.log("Starting import for OpenDota match ID: ".concat(e,", mapping to our match ID: ").concat(a));let[o,i]=await Promise.all([(0,n.iK)(),(0,n.RK)()]),{fetchOpenDotaMatch:c}=await Promise.resolve().then(t.bind(t,55835)),l=await c(e);try{let{game:t,performances:c}=(0,r.s)(l,o,i);await (0,n.uY)(a,t,c);try{let e=await fetch("/api/recalculate-match",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({matchId:a})});e.ok?console.log("Automatically recalculated scores and standings for match ".concat(a)):console.error("Failed to recalculate scores for match ".concat(a,":"),await e.text())}catch(e){console.error("Error calling recalculate API for match ".concat(a,":"),e)}return await s(e.toString()),console.log("Successfully imported and saved data for match ID: ".concat(e)),{success:!0,message:"Match ".concat(e," imported successfully.")}}catch(a){return console.log("Could not transform match ".concat(e," - likely a scrim or practice game: ").concat(a.message)),await s(e.toString()),{success:!0,message:"Match ".concat(e," skipped (likely scrim/practice game)."),skipped:!0}}}catch(a){return console.error("Failed to import match ".concat(e,":"),a),{success:!1,message:"Failed to import match.",error:a.message}}}async function _(e){try{let a=p.parse(e),r=await (0,n.iK)(),o=a.name.trim().toLowerCase();if(r.some(e=>e.name.trim().toLowerCase()===o))return{success:!1,message:'A team with the name "'.concat(a.name,'" already exists. Please choose a unique team name.')};let i=await Promise.all(a.players.map(async e=>{let a=await l(e.steamProfileUrl),t=await m(e.steamProfileUrl),r=await d(a);return{...e,steamId:a,steamId32:t.toString(),avatar:r.avatar,avatarmedium:r.avatarmedium,avatarfull:r.avatarfull}})),s={name:a.name,tag:a.tag,discordUsername:a.discordUsername,motto:a.motto,logoUrl:a.logoUrl||"",captainId:a.captainId,players:i,status:"pending"},c=e._authUser||void 0,u=n.DX;return u||(u=t(9086).DX),await u(s,c),{success:!0,message:"Team ".concat(a.name," registered successfully!")}}catch(e){if(e instanceof f.G)return console.error("Zod validation error:",e.errors),{success:!1,message:"Validation failed: "+e.errors.map(e=>"".concat(e.path.join("."),"- ").concat(e.message)).join(", ")};return console.error("Error registering team:",e),{success:!1,message:e.message||"An unknown error occurred."}}}},47262:(e,a,t)=>{t.d(a,{S:()=>c});var r=t(95155),o=t(12115),i=t(76981),s=t(10518),n=t(59434);let c=o.forwardRef((e,a)=>{let{className:t,...o}=e;return(0,r.jsx)(i.bL,{ref:a,className:(0,n.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...o,children:(0,r.jsx)(i.C1,{className:(0,n.cn)("flex items-center justify-center text-current"),children:(0,r.jsx)(s.A,{className:"h-4 w-4"})})})});c.displayName=i.bL.displayName},55835:(e,a,t)=>{t.d(a,{fetchOpenDotaMatch:()=>o,s:()=>s});var r=t(49509);async function o(e,a){let t="".concat(i,"/matches/").concat(e);if(a||r.env.OPENDOTA_API_KEY){let e=a||r.env.OPENDOTA_API_KEY;t+=(t.includes("?")?"&":"?")+"api_key="+e}let o=await fetch(t,{headers:{"User-Agent":"OpenDota_API_Fetch"}});if(!o.ok){let e=await o.text();throw Error("Failed to fetch OpenDota match: ".concat(o.status," ").concat(o.statusText,"\n").concat(e))}return o.json()}let i="https://api.opendota.com/api";function s(e,a,t){var r,o;function i(e,t){if(!t)return;let r=t.trim().toLowerCase();return a.find(e=>e.name.trim().toLowerCase()===r)}let s=i(null===(r=e.radiant_team)||void 0===r?void 0:r.team_id,e.radiant_name),n=i(null===(o=e.dire_team)||void 0===o?void 0:o.team_id,e.dire_name);if(!s||!n){let a=[];throw s||a.push("Radiant: ".concat(e.radiant_name)),n||a.push("Dire: ".concat(e.dire_name)),Error("Tournament teams not found in database: ".concat(a.join(", "),". This might be a scrim or practice game."))}return{game:{id:e.match_id.toString(),radiant_win:e.radiant_win,duration:e.duration,start_time:e.start_time,firstBloodTime:e.first_blood_time,picksBans:e.picks_bans||[],radiant_team:{id:s.id,name:s.name},dire_team:{id:n.id,name:n.name}},performances:e.players.map(e=>{let a=t.find(a=>a.steamId32===String(e.account_id)),r=e.player_slot<128,o=0;if(e.kill_streaks)for(let a in e.kill_streaks)parseInt(a)>o&&(o=parseInt(a));return{playerId:(null==a?void 0:a.id)||"unknown_".concat(e.account_id),teamId:r?s.id:n.id,heroId:e.hero_id,kills:e.kills,deaths:e.deaths,assists:e.assists,gpm:e.gold_per_min,xpm:e.xp_per_min,lastHits:e.last_hits,denies:e.denies,netWorth:e.net_worth,heroDamage:e.hero_damage,towerDamage:e.tower_damage,obsPlaced:e.obs_placed||0,senPlaced:e.sen_placed||0,courierKills:e.courier_kills||0,firstBloodClaimed:e.firstblood_claimed||!1,observerKills:e.observer_kills||0,sentryKills:e.sentry_kills||0,highestKillStreak:o,buybackCount:e.buyback_count||0,heroHealing:e.hero_healing||0,fantasyPoints:0}})}}}}]);